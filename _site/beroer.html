<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<style>
body {
  width: 800px;
  margin: 0 auto;
}
  <title>Berør</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
</header>
<h1 id="berør">Berør</h1>
<blockquote>
<p>En hjemmeside, som følger de besøgendes bevægelser og derigennem laver det område, der oplever størst bevægelse rødt. Denne bevægelse skal sendes til maskinen, som så laver det om til mere/mindre varme.</p>
</blockquote>
<h1 id="todo">Todo</h1>
<ul>
<li><p>[ ] Sæt en local Ruby on Rails op med Action Cable - husk Postgres og Angular</p></li>
<li><p>Skal hjemmesiden automatisk gå i fuldskærm mode?</p></li>
</ul>
<h2 id="actioncable---så-de-besøgende-ser-de-andres-bevægelse-in-real-time">Actioncable - Så de besøgende ser de andres bevægelse in real time</h2>
<ul>
<li>[ ] Hvordan virker det?</li>
<li>Der skal køre en ekstra server i baggrunden.
<ul>
<li>./bin/cable server i et vindue - rails server i et andet</li>
<li>bin har en fil, der hedder cable, som ser sådan her ud: <code>bundle exec puma -o 28080 cavle.config.ru</code></li>
<li>config/redis/cable er selve forbindelsen - tjek “redis pubsub” ud på Google.o</li>
<li>Kig i channels/application_cable for at se alle filerne</li>
<li>Rails app sends message to -&gt; Redis -&gt; Actioncable through WebSockets –&gt; Clientside browser.</li>
<li>Man kan generere channels fra shell: <code>rails g channel WebNotifications</code> for eksempel</li>
</ul></li>
</ul>
<p>Eksempel på kode fra videoen:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode coffee"><code class="sourceCode coffee"><a class="sourceLine" id="cb1-1" data-line-number="1">App<span class="kw">.</span>room <span class="kw">=</span> App<span class="kw">.</span>cable<span class="kw">.</span>subscriptions<span class="kw">.</span>create <span class="st">&quot;WebNotificationsChannel&quot;</span><span class="kw">,</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  received<span class="kw">:</span> <span class="fu">(data) -&gt;</span> </a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    $<span class="kw">(</span><span class="st">&#39;#messages&#39;</span><span class="kw">).</span>append data<span class="kw">[</span><span class="st">&#39;message&#39;</span><span class="kw">]</span></a></code></pre></div>
<h4 id="applicationcable">ApplicationCable</h4>
<p>For hver WebSocket (den der laver forbindelsen frem og tilbage mellem besøgende og app), bliver et connection object initiated. Det er også her du authorize en incomming connection</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">module</span> <span class="dt">ApplicationCable</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw">class</span> <span class="dt">Connection</span> &lt; <span class="dt">ActionCable</span>::<span class="dt">Connection</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    identified_by <span class="st">:current_user</span> <span class="co"># Can be used to find the specefic connection later</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"> </a>
<a class="sourceLine" id="cb2-5" data-line-number="5">    <span class="kw">def</span> connect</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">      <span class="dv">self</span>.current_user = find_verified_user</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"> </a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    <span class="kw">private</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">      <span class="kw">def</span> find_verified_user</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">        <span class="kw">if</span> verified_user = <span class="dt">User</span>.find_by(<span class="st">id: </span>cookies.encrypted[<span class="st">:user_id</span>])</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">          verified_user</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">        <span class="kw">else</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">          reject_unauthorized_connection</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">        <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">      <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="kw">end</span></a></code></pre></div>
<h4 id="channel">Channel</h4>
<p>En Channel er hvad din controller er i MVC for din Action Cabel. Det er her din logik ligger.</p>
<p>Du har din parent channel i <code>app/channels/application_cable/channel.rb</code></p>
<p>Derefter opretter du dine egne channels, som nekommer fra channel.rb:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">class</span> <span class="dt">ChatChannel</span> &lt; <span class="dt">ApplicationCable</span>::<span class="dt">Channel</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">end</span></a></code></pre></div>
<h4 id="subscription">Subscription</h4>
<p>Consumers (en bruger, der er koblet op) subscribes to channels acting as subscribers.</p>
<p>Subscribed is called when the consumer has successfully become a subscriber to this channel.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">class</span> <span class="dt">ChatChannel</span> &lt; <span class="dt">ApplicationCable</span>::<span class="dt">Channel</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="kw">def</span> subscribed</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw">end</span></a></code></pre></div>
<h2 id="clientside">Clientside</h2>
<p>En consumer har brug for en instance af en consumer på clientsiden. Dette bliver automatisk genereret af Rails (skal nok sættes op i Angular)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">// app/assets/javascripts/cable.js</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">//= require action_cable</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">//= require_self</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">//= require_tree ./channels</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"> </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  <span class="kw">this</span>.<span class="at">App</span> <span class="op">||</span> (<span class="kw">this</span>.<span class="at">App</span> <span class="op">=</span> <span class="op">{}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"> </a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  <span class="va">App</span>.<span class="at">cable</span> <span class="op">=</span> <span class="va">ActionCable</span>.<span class="at">createConsumer</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="op">}</span>).<span class="at">call</span>(<span class="kw">this</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Læg mærke til ActionCable connection.</strong></p>
<p>Men hver consumer skal have en subsciption til en cabel:</p>
<pre class="javascipt"><code>App.cable.subscriptions.create { channel: &quot;ChatChannel&quot;, room: &quot;Best Room&quot; }</code></pre>
<p>Her specificere man, hvilken cable, som der skal skabes en forbindelse til.</p>
<p>App.cable blev generet i forrige javascript, og kan nu bruges til at lave en connection (subscription).</p>
<h3 id="installering-og-brug-af-redis">Installering og brug af Redis</h3>
<ul>
<li>Installér: <code>brew install redis</code></li>
<li>Husk at starte redis: <code>brew services start redis</code></li>
<li>Husk at installere det i gemfile!</li>
<li>Derefter skal man konfigurere i <code>config/cables.yml</code>.
<ul>
<li>I videoen sætter han production indstillingerne til development, så han kan vise det</li>
<li></li>
</ul></li>
</ul>
<p>*I videoen tester han funktionaliteten via <code>rails console</code> og skriver så: <code>ActionCable.server.broadcast 'web_notifications_channel: {:message=&gt;&quot;&lt;p&gt;Hello world&lt;/p&gt;&quot;}</code></p>
<h1 id="spørgsmål-og-svar">Spørgsmål og svar</h1>
<p><strong>What is Pub/Sub?</strong> Pub/Sub, or Publish-Subscribe, refers to a message queue paradigm whereby senders of information (publishers), send data to an abstract class of recipients (subscribers), without specifying individual recipients. Action Cable uses this approach to communicate between the server and many clients.</p>
<p><strong>Hvad er WebSockets?</strong> Det gør det muligt at kommunikere mellem en server og frontend/client/browser. Dataen kan bevæge sig begge veje. Det gør det muligt at gøre brug af real time dataflow (uden reload, som jeg gerne vil have)</p>
</body>
</html>
